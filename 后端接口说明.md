# 后端接口说明

相关路径文件 `backend/urls.py`

由前端提出接口需求，后端实现

> wzk：
>
> ### POST请求
>
> * 每个views函数前面加上修饰：
>
>   ```python
>   @api_view(['POST'])
>   @authentication_classes([])  # 添加
>   ```
>
> * 每个函数返回值都写一个字典`res`，然后用`my_response(res)`封装成`HttpResponse(content_type="application/json")`进行返回
>
> * 建议每个函数套一个try， except里返回`errCode`和`msg`（python报错信息字符串），这样报错了在前端后端都能debug
> * 每个返回json都可以包含`success`、`errCode`和`msg`属性~~（即使这里可能没写）~~，前端所有请求只要`success=False`就会弹窗提示`errCode`和`msg`
>
> ### GET请求
>
> TODO



[TOC]



## 用户账户

### 用户登录 `login/`

* 验证登录信息，在数据库中保存该用户信息，取得登录凭证`token`

* 参数

  ```json
  {
  	'code' : "sdgajhbdsjfwbejkf", //wx.login生成的code，需后端转换成openid
  	'userInfo' : {} //内容参见https://developers.weixin.qq.com/miniprogram/dev/api/open-api/user-info/UserInfo.html
  }
  ```

* 返回

  ```json
  {
  	'success' : true / false,
  	'userExist' : 1, //0为新注册，1为已存在用户
      'token' : 'some random token', //服务器返回的登录凭证
      'email' : 'abcdef@buaa.edu.cn' / '', //邮箱，如果还未认证邮箱则返回空串
      
    //TODO:以下信息 在登录时直接返回？
      //还是每次点活动/组织页面时判断是否是管理员/是否关注等等
      'controlAct' : {
          [114514, 'name1'],
          [233333, 'name2']
      }, // 管理的活动列表，元素为id和名称，下面几个类似
  	'joinOrg' : {},
      'controlOrg' : {},
      
  }
  ```





### 发送验证码邮件 `sendVerify/`

* 向指定邮箱发送验证码，缓存中保存邮箱和验证码配对信息

- 参数

  ```json
  {
  	"email" : "abcde@buaa.edu.cn"
  }
  ```

  

- 返回

  ```json
{
		"success" : true,
  	"msg" : "Email send" 
  }
  ```





### 验证码验证 `verify/`

- 验证用户输入的验证码是否和邮箱对应，对应则在数据库中保存用户的邮箱（以后登录则不必认证）

- 参数

  ```json
  {
  	"verifyCode" : "wzkwzk",
      "email" : "abcde@buaa.edu.cn"
  }
  ```

  

- 返回

  ```json
  {
  	"success" : true / false,
      "msg" : "Valid Code" / "Invalid Code"
  }
  ```



### 获得用户信息 TODO

* 获得用户的信息

* 参数

  ```json
  {
  	"token" : "some token"
  }
  ```

  

* 返回

  ```json
  {
      "email" : "aaa@buaa.edu.cn",
      "motto" : "苟利国家生死以", //描述/个性签名 
      "nickName" : "蛤蛤蛤", //昵称
      "avatarUrl" : "http://xxx", //头像图片链接
  }
  ```



### 提交用户反馈 TODO

* 提交反馈内容及联系方式

* 参数

  ```json
  {
  	"feedback" : "我们BUAA真是太厉害了！",
      "contact" : "微信wzk_1015"
  }
  ```

* 返回

  ```json
  {
      "success" : true,
      "msg" : "upload feedback succeed"
  }
  ```

