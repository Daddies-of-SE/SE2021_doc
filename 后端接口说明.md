# 后端接口说明

相关路径文件 `backend/urls.py`

由前端提出接口需求，后端实现

> wzk：
>
> ### POST请求
>
> * 每个views函数前面加上修饰：
>
>   ```python
>   @api_view(['POST'])
>   @authentication_classes([])  # 添加
>   ```
>
> * 每个函数返回值都写一个字典`res`，然后用`my_response(res)`封装成`HttpResponse(content_type="application/json")`进行返回
>
> * 建议每个函数套一个try， except里返回`errCode`和`msg`（python报错信息字符串），这样报错了在前端后端都能debug
> * 每个返回json都可以包含`success`、`errCode`和`msg`属性~~（即使这里可能没写）~~，前端所有请求只要`success=False`就会弹窗提示`errCode`和`msg`
>
> ### GET请求
>
> TODO



[TOC]

## 说明

1. 目前**权限**功能未实现，如果用户端/管理端需要使用某个接口可自行在接口说明下的权限添加。
2. 前端需要额外的哪些接口，请在TODO中添加，并指明**需要用哪些参数请求哪些信息**。
3. 后端接口编写按照下方**模板**统一格式。

## TODO

- [ ] 用户是否能够修改头像？用户头像目前存的是微信头像的url。（目前未实现）

 



## 模板

### 标题 GET `xxx/xxx/`

**权限**

用户端/管理端

**说明**

xxxxxxxxxxxxxxxxxx

**Request**

URL：http://127.0.0.1:8000/xxx/xxx/

Body：

```json

```

**Success Response**

状态码：2xx

Body：

```json

```

**Error Response**

①

出错说明xxxxxxxxxxxxx

状态码：4xx

Body：

```json

```

②







## 用户账户

### 用户登录 `login/`

#### POST

* 验证登录信息，在数据库中保存该用户信息，取得登录凭证`token`

* Request Body

  ```json
  {
  	'code' : "sdgajhbdsjfwbejkf", //wx.login生成的code，需后端转换成openid
  	'userInfo' : {} //内容参见https://developers.weixin.qq.com/miniprogram/dev/api/open-api/user-info/UserInfo.html
  }
  ```

* Success Response

  状态码 200
  
  ```json
  {
  	'status' : 0, 
  	'userExist' : 1, //0为新注册，1为已存在用户
      'token' : 'some random token', //服务器返回的登录凭证，缓存在本地
      'email' : 'abcdef@buaa.edu.cn' / '', //邮箱，如果还未认证邮箱则返回空串
      'id' :  'user.id', //用户的id，缓存在本地
      'avatar' : 'xxx.com', //用户头像的url
      'sign' : 'xxxxx', //个性签名
      'name' : 'xxx', //用户名
      
      
    //TODO:以下信息 在登录时直接返回？
      //还是每次点活动/组织页面时判断是否是管理员/是否关注等等
      'controlAct' : {
          [114514, 'name1'],
          [233333, 'name2']
      }, // 管理的活动列表，元素为id和名称，下面几个类似
  	'joinOrg' : {},
      'controlOrg' : {},
      
  }
  ```

- Error Response

  注：正常小程序运行过程不会发生，因为code是自动获取的。

  状态码 400

  ```json
  {
      'status' : 1,
      'errcode' : 'xxxxx', //微信服务接口返回的error code
      'msg' : 'xxxxxx', //微信服务接口返回的错误信息
  }
  ```

  



### 发送验证码邮件 `sendVerify/`

#### POST

* 向指定邮箱发送验证码，缓存中保存邮箱和验证码配对信息

- Request Body

  ```json
  {
  	"email" : "abcde@buaa.edu.cn"
  }
  ```

- Success Response

  状态码：200

	```json
  {
  	"status" : 0,
      "msg" : 'Email send',
  }
  ```





### 验证码验证 `verify/`

#### POST

验证用户输入的验证码是否和邮箱对应，对应则在数据库中保存用户的邮箱（以后登录则不必认证）

**Request Body**

```json
{
	"verifyCode" : "wzkwzk",  //验证码
    "email" : "abcde@buaa.edu.cn", //验证邮箱
    "id" : "user.id" //用户的id
}
```

**Success Response**

状态码：200

```json
{
	"status" : 0,
    "msg" : "Valid Code"
}
```

**Error Response**
状态码：400

```json
{
    "status" : 1,
    "msg" : "Incalid Code"
}
```



### 获得用户信息 TODO

* 获得用户的信息

* 参数

  ```json
  {
  	"token" : "some token"
  }
  ```

  

* 返回

  ```json
  {
      "email" : "aaa@buaa.edu.cn",
      "motto" : "苟利国家生死以", //描述/个性签名 
      "nickName" : "蛤蛤蛤", //昵称
      "avatarUrl" : "http://xxx", //头像图片链接
  }
  ```



### 提交用户反馈 TODO

* 提交反馈内容及联系方式

* 参数

  ```json
  {
  	"feedback" : "我们BUAA真是太厉害了！",
      "contact" : "微信wzk_1015"
  }
  ```

* 返回

  ```json
  {
      "success" : true,
      "msg" : "upload feedback succeed"
  }
  ```











## 用户

### 获取所有用户 GET `users/`

**权限**

管理端

**说明**

获取所有用户的信息

**Request**

URL：http://127.0.0.1:8000/users/

Request Body：无

**Success Response**

状态码：200

Body：

```json
[
    {
        "id": 1,
        "openid": "openid111",
        "name": "nicheng111",
        "avatar": "touxiang111",
        "email": null,
        "sign": "sign111"
    },
    {
        "id": 2,
        "openid": "openid2",
        "name": "nicheng2",
        "avatar": "touxiang2",
        "email": null,
        "sign": "sign2"
    }
]
```

**Error Response**

无

### 获取指定用户信息 GET `users/{id}/`

**权限**

用户端，管理端

**说明**

获取编号为id的用户的信息，返回内容包括id，名称，头像地址，邮箱，个性签名

**Request**

URL：http://127.0.0.1:8000/users/1/（表示获取id=1的用户的信息）

Body：无

**Success Response**

状态码：200

Body：

```json
{
    "id": 1,
    "name": "nicheng111",
    "avatar": "touxiang111",
    "email": null,
    "sign": "sign111"
}
```

**Error Response**

①

对应id的用户不存在

状态码：404

Body：

```json
{
    "detail": "未找到。"
}
```

### 删除指定用户 GET `users/{id}/`

**权限**

用户端，管理端

**说明**

删除编号为id的用户

**Request**

URL：http://127.0.0.1:8000/users/1/（表示删除id=1的用户）

Body：无

**Success Response**

状态码：204

Body：无

**Error Response**

①

指定id用户不存在

状态码：404

Body：

```json
{
    "detail": "未找到。"
}
```

### 修改指定用户信息 PUT `users/{id}/`

**权限**

用户端

**说明**

用于修改编号为id的用户的昵称，个性签名 

**Request**

URL：http://127.0.0.1:8000/users/5/（修改编号为5的用户的信息）

Body：

```json
{
    "name" : "myname", //昵称name为必填字段
    "sign" : "this is my sign", //个性签名sign为选填字段
}
```

**Success Response**

状态码：200

Body：

```json
{
    "id": 6,
    "name": "myname",
    "avatar": "asdfa",
    "email": "adfasdf@qq.com",
    "sign": "this is my sign"
}
```

**Error Response**

①

request body中不包含name字段

状态码：400

Body：

```json
{
    "name": [
        "该字段是必填项。"
    ]
}
```

②

request body中name字段的值为空

状态码：400

Body：

```json
{
    "name": [
        "该字段不能为空。"
    ]
}
```

③

指定id用户不存在（正常情况下不会发生）

状态码：404

Body：

```json
{
    "detail": "未找到。"
}
```





## 版块

### 获取所有版块 GET  `blocks/`

获取所有版块的id和名称

**Request**

URL：http://127.0.0.1:8000/blocks/

Request Body：无

**Success Response**

状态码：200

Body：

```json
[
    {
        "id": 1,
        "name": "博雅"
    },
    {
        "id": 2,
        "name": "志愿"
    },
    {
        "id": 3,
        "name": "社团"
    }
]
```

**Error Response**

无

### 新建版块 POST `blocks/`

创建一个新的版块

**Request**

URL：http://127.0.0.1:8000/blocks/

Body：

```json
{
    "name" : "社团" //新建版块名称
}
```

**Success Response**

状态码：201

Body：

```json
{
    "id": 4, //新建版块的id
    "name": "社团" //新建版块的名称
}
```

**Error Response**

如果新的版块名称与已有版块名称重复

状态码：400

Body：

```json
{
    "name": [
        "具有 版块名称 的 block 已存在。"
    ]
}
```

### 修改指定版块信息 PUT `blocks/{id}/`

修改编号为id的版块

**Request**

URL：http://127.0.0.1:8000/blocks/4/（表示修改id=4的版块的名称）

Body：

```json
{
    "name" : "版块4" 
}
```

**Success Response**

状态码：200

Body：

```json
{
    "id": 4,
    "name": "版块4"
}
```

**Error Response**

①

如果修改后的版块名称与已有版块名称重复

状态码：400

Body：

```json
{
    "name": [
        "具有 版块名称 的 block 已存在。"
    ]
}
```

②

如果修改后和修改前的名称一致

状态码：400

Body：

```json
{
    "block": [
        "板块名称重复"
    ]
}
```

### 删除指定版块 DELETE `blocks/{id}/`

删除编号为id的版块

URL：http://127.0.0.1:8000/blocks/4/（表示删除id=4的版块）

Request Body：无

**Success Response**

状态码：204

Body：无

**Error Response**

对应id的版块不存在

状态码：404

Body：

```json
{
    "detail": "未找到。"
}
```



## 组织申请

### 创建组织申请 POST `organizations/applications/`

**权限**

用户端

**说明**

用户可以提交组织申请，用于向管理员申请创建一个新的组织

**Request**

URL：http://127.0.0.1:8000/organizations/applications/

Body：

```json
{
    "name" : "test组织", //必填，组织名称
    "description": "我的申请理由", //必填，申请理由
    "user": 7,	//必填，申请用户的id
    "block": 1	//必填， 申请组织所在的版块id
}
```

**Success Response**

状态码：202

Body：

```json
{
    "id": 4,                                            //组织id
    "name": "test组织",                                  //组织名称
    "description": "我的申请理由",                        //申请理由
    "pub_time": "2021-04-15T11:26:32.396852",           //申请时间
    "status": 0,                                        //审批状态（0：待审批；1：审批通过；2：审批未通过）
    "user": 7,										    //申请用户id
    "block": 1											//申请组织所在的版块id
}
```

**Error Response**

①

缺少某个必填字段，name/dsescription/user/block缺少哪个body中就会返回哪个

状态码：400

Body：

```json
{
    "description": [
        "该字段是必填项。"
    ],
    "user": [
        "该字段是必填项。"
    ],
}
```

②

name/description为空，哪个为空body就会返回哪个

状态码：400

Body:

```json
{
    "name": [
        "该字段不能为空。"
    ],
    "description": [
        "该字段不能为空。"
    ]
}
```

③

组织名与已存在的组织名重复

状态码：400

```json
{
    "name": [
        "已经存在该名称的组织。"
    ]
}
```

④

组织名与已经提交的，未经审批的组织名相同

状态码：400

```json
{
    "name": [
        "已经存在该名称组织的申请"
    ]
}
```



**注：上述错误可能同时出现在同一个Error Response Body中。**



### 获取指定用户的所有组织申请 GET `users/organizations/applications/{user_id}`

**权限**

用户端

**说明**

用于获取id=user_id的用户的所有组织申请

**Request**

URL：http://127.0.0.1:8000/users/organizations/applications/7/（表示获取id=7的用户的所有组织申请）

Body：无

**Success Response**

状态码：200

Body：

```json
[
    {
        "id": 1,
        "name": "组织1",
        "description": "我想申请",
        "pub_time": "2021-04-15T11:13:11.572283",
        "status": 0,      //审批状态（0：待审批；1：审批通过；2：审批未通过）
        "user": {
            "id": 7,
            "openid": "test_openid",
            "name": "用户1",
            "avatar": null,
            "email": null,
            "sign": null
        },
        "block": {
            "id": 1,
            "name": "博雅"
        }
    },
    {
        "id": 2,
        "name": "组织2",
        "description": "理由",
        "pub_time": "2021-04-15T11:21:59.062922",
        "status": 0,
        "user": {
            "id": 7,
            "openid": "test_openid",
            "name": "用户1",
            "avatar": null,
            "email": null,
            "sign": null
        },
        "block": {
            "id": 2,
            "name": "志愿"
        }
    }
]

// 若无对应用户的组织申请则返回: 
// []
```

**Error Response**

无



### 获取所有组织申请GET `organizaitons/applications/`

**权限**

管理端

**说明**

用于获取所有的组织申请

**Request**

URL：http://127.0.0.1:8000/organizations/applications/

Body：无

**Success Response**

状态码：200

Body：

```json
[
    {
        "id": 1,
        "name": "组织1",
        "description": "我想申请",
        "pub_time": "2021-04-15T11:13:11.572283",
        "status": 0,      //审批状态（0：待审批；1：审批通过；2：审批未通过）
        "user": {
            "id": 7,
            "openid": "test_openid",
            "name": "用户1",
            "avatar": null,
            "email": null,
            "sign": null
        },
        "block": {
            "id": 1,
            "name": "博雅"
        }
    },
    {
        "id": 2,
        "name": "组织2",
        "description": "理由",
        "pub_time": "2021-04-15T11:21:59.062922",
        "status": 0,
        "user": {
            "id": 7,
            "openid": "test_openid",
            "name": "用户1",
            "avatar": null,
            "email": null,
            "sign": null
        },
        "block": {
            "id": 2,
            "name": "志愿"
        }
    }
]

// 若无组织申请则返回: 
// []
```

**Error Response**

无



### 删除指定组织申请 DELETE `organizations/applications/{id}`

**权限**

用户端，管理端

**说明**

删除编号为id的组织申请

**Request**

URL：http://127.0.0.1:8000/organizations/applications/4/（表示删除id=4的组织申请）

Body：无

**Success Response**

状态码：204

Body：无

**Error Response**

①

对应id的组织申请不存在

状态码：404

Body：

```json
{
    "detail": "未找到。"
}
```



### 审批组织申请PUT `organizations/applications/verifications/{id}/`

**权限**

管理端

**说明**

审核指定id的组织申请，status表示审批状态。

status=0 表示待审批，此状态的组织申请可以审批。

status=1 表示审批通过。

status=2 表示审批不通过。

**Request**

URL：http://127.0.0.1:8000/organizations/applications/verifications/4/（表示对id=4的组织申请进行审批）

Body：

```json
{
    "status": 1  //1：表示审批通过；2：表示审批不通过
}
```

**Success Response**

状态码：201

Body：

```json
{
    "status": 1
}
```

**Error Response**

①

对应id的组织申请已经被审批，即`status!=0​`（正常情况下不会发生）

状态码：400

Body：

```json
{
    "detail": [
        "该组织申请已审批。"
    ]
}
```

②

对应id的组织申请不存在

状态码：404

Body：

```json
{
    "detail": "未找到。"
}
```

③

如果传入的`status`参数不符（正常情况下不会发生）

状态码：400

```json
{
    "status": [
        "“5” 不是合法选项。"
    ]
}
```











## 组织







## GET

### 获取当前板块所有组织 `blocks/orgs/`

- 查看板块id下所有组织信息

  板块id与板块名称：{1：博雅，2：社团，3：学生会，4：志愿}

- 参数（放到query_params里如：http://127.0.0.1:8000/blocks/orgs/?block=1）

  ```json
  {
  	"block" : 1,
  }
  ```

- 返回

```json
{
    "status": 0,
    "msg": "ok",
    "results": [
        {
            "name": "Org1",
            "description": "this is Org1",
            "create_time": "2021-04-13T12:01:47.643533",
            "avatar": "url",
            "owner": {
                "id": 1,
                "openid": "12345",
                "name": "Jessica",
                "avatar": null,
                "email": "Jessica@qq.com",
                "sign": "just a little try"
            },
            "block": {
                "id": 1,
                "name": "博雅"
            }
        },
        {
            "name": "Org2",
            "description": "aba aba aba",
            "create_time": "2021-04-13T12:02:47.699920",
            "avatar": "url",
            "owner": {
                "id": 1,
                "openid": "12345",
                "name": "Jessica",
                "avatar": null,
                "email": "Jessica@qq.com",
                "sign": "just a little try"
            },
            "block": {
                "id": 1,
                "name": "博雅"
            }
        }
    ]
}
```

### 获取组织信息 `organizations/`

- 获取所有组织以及组织的详细信息

- 参数 放到query_params http://127.0.0.1:8000/organizations/?org=Org2

  ```json
  {
  	"org" : "Org2",
  }
  ```

  若无参数，则返回所有组织的详细信息

- 返回

  - 有参数

  ```json
  {
      "status": 0,
      "msg": "ok",
      "results": {
          "name": "Org2",
          "description": "aba aba aba",
          "create_time": "2021-04-13T12:02:47.699920",
          "avatar": "url",
          "owner": {
              "id": 1,
              "openid": "12345",
              "name": "Jessica",
              "avatar": null,
              "email": "Jessica@qq.com",
              "sign": "just a little try"
          },
          "block": {
              "id": 1,
              "name": "博雅"
          }
      }
  }
  ```

  - 有参数 报错

  ```json
  {
      "status": 1,
      "msg": "invalid org name"
  }
  ```

  - 无参数

  ```json
  {
      "status": 0,
      "msg": "ok",
      "results": [
          {
              "name": "Org1",
              "description": "this is Org1",
              "create_time": "2021-04-13T12:01:47.643533",
              "avatar": "url",
              "owner": {
                  "id": 1,
                  "openid": "12345",
                  "name": "Jessica",
                  "avatar": null,
                  "email": "Jessica@qq.com",
                  "sign": "just a little try"
              },
              "block": {
                  "id": 1,
                  "name": "博雅"
              }
          },
          {
              "name": "Org2",
              "description": "aba aba aba",
              "create_time": "2021-04-13T12:02:47.699920",
              "avatar": "url",
              "owner": {
                  "id": 1,
                  "openid": "12345",
                  "name": "Jessica",
                  "avatar": null,
                  "email": "Jessica@qq.com",
                  "sign": "just a little try"
              },
              "block": {
                  "id": 1,
                  "name": "博雅"
              }
          }
      ]
  }
  ```

  

### 查看指定组织的所有管理员 `organizations/managers/`

- 根据组织名称查看所有管理员

- 参数 放到query_params，若无则返回所有组织-管理员

  ```
  {
  	"org" : "Org2",
  }
  ```

- 返回

  - 有参数，有组织管理员

  ```json
  {
      "status": 0,
      "msg": "ok",
      "results": [
          {
              "org": {
                  "name": "Org1",
                  ...
              },
              "person": {
                  "id": 1,
                  "openid": "12345",
                  "name": "Jessica",
                  "avatar": null,
                  "email": "Jessica@qq.com",
                  "sign": "just a little try"
              }
          },
          {
              "org": {
                  "name": "Org1",
                 ...
              },
              "person": {
                  "id": 2,
                  "openid": "23456",
                  "name": "jessie",
                  "avatar": null,
                  "email": "jessir@qq.com",
                  "sign": "mio mio~"
              }
          }
      ]
  }
  ```

  - 有参数 无组织管理员

    ```json
    {
        "status": 0,
        "msg": "ok",
        "results": []
    }
    ```

  - 有参数报错

    ```json
    {
        "status": 1,
        "msg": "invalid org name"
    }
    ```

  - 无参数 返回所有

    ```json
    {
        "status": 0,
        "msg": "ok",
        "results": [
            {
                "org": {
                    "name": "Org1",
                    ...
                },
                "person": {
                    "id": 1,
                    "openid": "12345",
                    "name": "Jessica",
                    "avatar": null,
                    "email": "Jessica@qq.com",
                    "sign": "just a little try"
                }
            },
            {
                "org": {
                    "name": "Org1",
                   ...
                },
                "person": {
                    "id": 2,
                    "openid": "23456",
                    "name": "jessie",
                    "avatar": null,
                    "email": "jessir@qq.com",
                    "sign": "mio mio~"
                }
            }
        ]
    }
    ```

    

### 查看当前用户信息 `users/`

- 根据前端给的用户id查看当前用户信息
- 参数 放到query_params http://127.0.0.1:8000/users?id=2

```json
{
	"id" : 2,
}
```

- 返回

```json
{
    "status": 0,
    "msg": "ok",
    "results": {
        "id": 2,
        "openid": "23456",
        "name": "jessie",
        "avatar": null,
        "email": "jessir@qq.com",
        "sign": "mio mio~"
    }
}
```

报错

```json
{
    "status": 1,
    "msg": "invalid userID"
}
```

### 查看用户管理的所有组织 `users/organizations/`

- 查看当前用户管理的所有组织信息

- 参数 放到query_params

  ```json
  {
  	"id" : 2,
      'user_view':True  #这个必须设为True，区别通过组织查管理员
  }
  ```

- 返回

  - 有管理组织

    ```json
    {
        "status": 0,
        "msg": "ok",
        "results": [
            {
                "org": {
                    "name": "Org1",
                    "description": "this is Org1",
                    "create_time": "2021-04-13T12:01:47.643533",
                    "avatar": "url",
                    "owner": {
                        "id": 1,
                        "openid": "12345",
                        "name": "Jessica",
                        "avatar": null,
                        "email": "Jessica@qq.com",
                        "sign": "this is my new sign!"
                    },
                    "block": {
                        "id": 1,
                        "name": "博雅"
                    }
                },
                "person": {
                    "id": 1,
                    "openid": "12345",
                    "name": "Jessica",
                    "avatar": null,
                    "email": "Jessica@qq.com",
                    "sign": "this is my new sign!"
                }
            }
        ]
    }
    ```

  - 无管理组织

    ```json
    {
        "status": 0,
        "msg": "ok",
        "results": []
    }
    ```

  - 报错

    ```json
    {
        "status": 1,
        "msg": "invalid userID"
    }
    ```

    

<<<<<<< Updated upstream
  
=======
```json
{
    "name": "组织名",  //必填
    "description": "组织描述", //选填
    "avatar": "组织头像url"  //选填
}
```

**Success Response**

状态码：200

Body：

```json
{
    "id": 1,
    "name": "组织",
    "description": "我是描述",
    "create_time": "2021-04-15T14:19:18.881913",
    "avatar": "我是图片链接",
    "owner": {
        "id": 5,
        "openid": "openid111",
        "name": "dd",
        "avatar": "111",
        "email": "1111@qq.com",
        "sign": ""
    },
    "block": {
        "id": 1,
        "name": "博雅"
    }
}
```

**Error Response**

①

对应id的组织不存在

状态码：404

Body：

```json
{
    "detail": "未找到。"
}
```

②

request body中缺少name字段

状态码：400

Body：

```json
{
    "name": [
        "该字段是必填项。"
    ]
}
```

③

request body中name字段为空

Body：

```json
{
    "name": [
        "该字段不能为空。"
    ]
}
```

④

修改后的组织名name与已有组织名重复

状态码：400

Body：

```json
{
    "name": [
        "具有 组织名称 的 organization 已存在。"
    ]
}
```

### 删除指定组织 DELETE `organizations/{id}/`

**权限**

用户端（负责人），管理端

**说明**

删除编号为id的组织

**Request**

URL：http://127.0.0.1:8000/organizations/1/

Body：无

**Success Response**

状态码：204

Body：无

**Error Response**

①

对应id的组织不存在

状态码：404

Body：

```json
{
    "detail": "未找到。"
}
```



### 组织负责人转让 POST `organizations/owner/{id}`

**权限**

用户端（负责人），管理端

**说明**

将编号为id的组织的负责人更改为指定用户。

**Request**

URL：http://127.0.0.1:8000/organizations/owner/3/

Body：

```json
{
    "owner": 6   //用户id（未来的组织负责人）
}
```

**Success Response**

状态码：200

Body：

```json
{
    "owner": 6
}
```

**Error Response**

①

owner字段缺失

状态码：400

Body：

```json
{
    "owner": [
        "该字段是必填项。"
    ]
}
```

②

对应id的组织不存在。

状态码：404

Body：

```json
{
    "detail": "未找到。"
}
```



## 关注组织

### 用户关注组织 POST `users/followed_organizations/`

**权限**

用户端

**说明**

用户关注组织

**Request**

URL：http://127.0.0.1:8000/users/followed_organizations/

Body：

```json
{
    "org": 3,   //组织id，必填
    "person": 7	//用户id，必填
}
```

**Success Response**

状态码：201

Body：

```json
{
    "id": 1,
    "org": 3,
    "person": 7
}
```

**Error Response**

①

对应id的组织/用户不存在。（正常情况下不会出现）

状态码：400

Body：

```json
{
    "org": [
        "无效主键 “xx” － 对象不存在。" //xx为传入的组织id
    ],
    "person": [
        "无效主键 “xx” － 对象不存在。" //xx为传入的用户id
    ]
}
```

②

对应id的用户已经关注对应id的组织。

状态码：400

```json
{
    "non_field_errors": [
        "已关注该组织。"
    ]
}
```



### 用户取消关注组织 DELETE `users/followed_organizations/?user=&org=`

**权限**

用户端

**说明**

对应id用户取消关注对应id组织

**Request**

URL：http://127.0.0.1:8000/users/followed_organizations/?user=7&org=3（参数在query params中，分别为用户id和组织id）

Body：无

**Success Response**

状态码：204

Body：无

**Error Response**

无



### 获取指定用户关注的所有组织GET `users/followed_organizations/{id}/`

**权限**

用户端

**说明**

获取编号为id的用户的关注的所有组织

**Request**

URL：http://127.0.0.1:8000/users/followed_organizations/6/

Body：无

**Success Response**

状态码：200

Body：

```json
[
    {
        "org": {
            "id": 3,
            "name": "组织",
            "description": null,
            "create_time": "2021-04-15T15:53:14.944308",
            "avatar": null,
            "owner": {
                "id": 7,
                "openid": "test_openid",
                "name": "用户1",
                "avatar": null,
                "email": null,
                "sign": null
            },
            "block": {
                "id": 1,
                "name": "博雅"
            }
        }
    },
    {
        "org": {
            "id": 4,
            "name": "组织5",
            "description": null,
            "create_time": "2021-04-15T16:41:33.383075",
            "avatar": null,
            "owner": {
                "id": 7,
                "openid": "test_openid",
                "name": "用户1",
                "avatar": null,
                "email": null,
                "sign": null
            },
            "block": {
                "id": 2,
                "name": "志愿"
            }
        }
    }
]


// 若对应id用户不存在，或无关注的组织，则返回：
// []
```

**Error Response**

无



## 组织管理

### 组织添加管理员 POST `organizations/managers/`

**权限**

用户端（负责人）

**说明**

指定组织添加指定用户为管理员

**Request**

URL：http://127.0.0.1:8000/organizations/managers/

Body：

```json
{
    "org": 3,   //组织id，必填
    "person": 5	//用户id，必填
}
```

**Success Response**

状态码：201

Body：

```json
{
    "id": 1,
    "org": 3,
    "person": 5
}
```

**Error Response**

①

对应id的组织/用户不存在。

状态码：400

Body：

```json
{
    "org": [
        "无效主键 “xx” － 对象不存在。" //xx为传入的组织id
    ],
    "person": [
        "无效主键 “xx” － 对象不存在。" //xx为传入的用户id
    ]
}
```

②

对应id的用户已经是对应id的组织的管理员。

状态码：400

```json
{
    "non_field_errors": [
        "该用户已是此组织管理员。"
    ]
}
```



### 取消组织管理员 DELETE `organizations/managers/?user=&org=`

**权限**

用户端（负责人）

**说明**

取消对应id用户的对应id组织的管理员身份

**Request**

URL：http://127.0.0.1:8000/organizations/managers/?user=7&org=3（参数在query params中，分别为用户id和组织id）

Body：无

**Success Response**

状态码：204

Body：无

**Error Response**

无



### 获取指定用户管理的所有组织GET `users/managed_organizations/{id}/`

**权限**

用户端

**说明**

获取编号为id的用户的管理的所有组织

**Request**

URL：http://127.0.0.1:8000/users/managed_organizations/5/

Body：无

**Success Response**

状态码：200

Body：

```json
[
    {
        "org": {
            "id": 3,
            "name": "组织",
            "description": null,
            "create_time": "2021-04-15T15:53:14.944308",
            "avatar": null,
            "owner": {
                "id": 7,
                "openid": "test_openid",
                "name": "用户1",
                "avatar": null,
                "email": null,
                "sign": null
            },
            "block": {
                "id": 1,
                "name": "博雅"
            }
        }
    },
    {
        "org": {
            "id": 4,
            "name": "组织5",
            "description": null,
            "create_time": "2021-04-15T16:41:33.383075",
            "avatar": null,
            "owner": {
                "id": 7,
                "openid": "test_openid",
                "name": "用户1",
                "avatar": null,
                "email": null,
                "sign": null
            },
            "block": {
                "id": 2,
                "name": "志愿"
            }
        }
    }
]


// 若对应id用户不存在，或无管理的组织，则返回：
// []
```

**Error Response**

无

### 获取指定组织的全部管理员 GET `organizations/managers/{id}/`

**权限**

用户端，管理端

**说明**

获取编号为id的组织的全部管理员

**Request**

URL：http://127.0.0.1:8000/organizations/managers/3/

Body：无

**Success Response**

状态码：200

Body：

```json
[
    {
        "person": {
            "id": 6,
            "openid": "6666",
            "name": "myname",
            "avatar": "asdfa",
            "email": "adfasdf@qq.com",
            "sign": "this is my sign"
        }
    },
    {
        "person": {
            "id": 7,
            "openid": "test_openid",
            "name": "用户1",
            "avatar": null,
            "email": null,
            "sign": null
        }
    }
]

// 若无对应id的组织，或对应id的组织无管理员，则返回:
// []
```

**Error Response**

无



## 活动分类

### 获取所有活动分类 GET  `activities/categories/`

**权限**

用户端，管理端

**说明**

获取所有分类的id和名称

**Request**

URL：http://127.0.0.1:8000/activities/categories/

Body：无

**Success Response**

状态码：200

Body：

```json
[
    {
        "id": 1,
        "name": "体育"
    },
    {
        "id": 2,
        "name": "文艺"
    },
    {
        "id": 3,
        "name": "音乐"
    }
]
```

**Error Response**

无



### 新建活动分类 POST `activities/categories/`

**权限**

管理端

**说明**

创建一个新的活动分类

**Request**

URL：http://127.0.0.1:8000/activities/categories/

Body：

```json
{
    "name" : "晚会" //新建活动分类的名称
}
```

**Success Response**

状态码：201

Body：

```json
{
    "id": 4, //新建活动分类的id
    "name": "晚会" //新建活动分类的名称
}
```

**Error Response**

如果新的活动分类名称与已有活动分类名称重复

状态码：400

Body：

```json
{
    "name": [
        "具有 分类名称 的 category 已存在。"
    ]
}
```



### 修改指定活动分类信息 PUT `activities/categories/{id}/`

**权限**

管理端

**说明**

修改编号为id的活动分类

**Request**

URL：http://127.0.0.1:8000/activities/categories/4/（表示修改id=4的活动分类的名称）

Body：

```json
{
    "name" : "分类4" 
}
```

**Success Response**

状态码：200

Body：

```json
{
    "id": 4,
    "name": "分类4"
}
```

**Error Response**

①

如果修改后的活动分类名称与已有活动分类名称重复

状态码：400

Body：

```json
{
    "name": [
        "具有 分类名称 的 category 已存在。"
    ]
}
```

②

如果修改后和修改前的名称一致

状态码：400

Body：

```json
{
    "category": [
        "分类名称重复"
    ]
}
```



### 删除指定活动分类 DELETE `activities/categories/{id}/`

**权限**

管理端

**说明**

删除编号为id的活动分类

**Request**

URL：http://127.0.0.1:8000/activities/categories/4/（表示删除id=4的活动分类）

Body：无

**Success Response**

状态码：204

Body：无

**Error Response**

对应id的活动分类不存在

状态码：404

Body：

```json
{
    "detail": "未找到。"
}
```



## 活动地址

### 获取所有活动地址GET  `activities/addresses/`

**权限**

用户端，管理端

**说明**

获取所有活动地址的id、名称、经度、纬度。

**Request**

URL：http://127.0.0.1:8000/activities/addresses/

Body：无

**Success Response**

状态码：200

Body：

```json
[
    {
        "id": 1,
        "name": "体育"
    },
    {
        "id": 2,
        "name": "文艺"
    },
    {
        "id": 3,
        "name": "音乐"
    }
]
```

**Error Response**

无



### 新建活动分类 POST `activities/addresses/`

**权限**

用户端，管理端

**说明**

创建一个新的活动地址

**Request**

URL：http://127.0.0.1:8000/activities/addresses/

Body：

```json
{
    "name" : "篮球场",             //新建活动地址的名称，必填
    "longitude": "123.123",  //地址经度，必填
    "latitude": "123.123",   //地址纬度，必填
}
```

**Success Response**

状态码：201

Body：

```json
{
    "id": 2,
    "name": "篮球场",
    "longitude": "123.123000",
    "latitude": "123.123000"
}
```

**Error Response**

①

新的活动地址名称与已有活动地址名称重复

状态码：400

Body：

```json
{
    "name": [
        "具有 地址名称 的 address 已存在。"
    ]
}
```

②

新的活动地址和已有的活动地址重复

状态码：400

Body：

```json
{
    "address": [
        "地点重复。"
    ]
}
```



### 删除指定活动地址 DELETE `activities/addresses/{id}/`

**权限**

管理端

**说明**

删除编号为id的活动地址

**Request**

URL：http://127.0.0.1:8000/activities/addresses/4/（表示删除id=4的活动地址）

Body：无

**Success Response**

状态码：204

Body：无

**Error Response**

对应id的活动地址不存在

状态码：404

Body：

```json
{
    "detail": "未找到。"
}
```







## 超级管理员

### Super User注册 `register/`

**POST request**

Body

```json
{
    "username":"Jessica",
    "password":"123456",
    "email": "wangjiarui@163.com"
}
```



### SuperUser登录 `adminLogIn/`

**POST request**

Body

```json
{
    "username":"Jessica",
    "password":"123456",
}
```

**success response**

```json
{
    "success": "true",
    "user": {
        "username": "Jessica"
    }
}
```

**Error response**

```json
{
    "success": "false",
    "mess": "Invalid User"
}
```
>>>>>>> Stashed changes

